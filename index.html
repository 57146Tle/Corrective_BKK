<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á Corrective BKK</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }

        .add-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-delete {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 5px 10px;
            font-size: 12px;
        }

        .btn-edit {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            padding: 5px 10px;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn-save {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            padding: 5px 10px;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn-cancel {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            padding: 5px 10px;
            font-size: 12px;
            margin-right: 5px;
        }

        .edit-input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .edit-textarea {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            resize: vertical;
            min-height: 40px;
        }

        .table-container {
            overflow-x: auto;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.3s;
        }

        tr:hover td {
            background-color: #f8f9fa;
        }

        .summary {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .summary-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .add-form {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Plan ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á Corrective BKK</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
        </div>

        <div class="controls">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="yearFilter">‡∏õ‡∏µ:</label>
                    <select id="yearFilter">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="monthFilter">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
                    <select id="monthFilter">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="01">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                        <option value="02">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                        <option value="03">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                        <option value="04">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                        <option value="05">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                        <option value="06">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                        <option value="07">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                        <option value="08">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                        <option value="09">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                        <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                        <option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                        <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchInput">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:</label>
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...">
                </div>
                <div class="filter-group">
                    <button class="btn" onclick="exportToExcel()" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                        üìä Export Excel
                    </button>
                </div>
            </div>

            <div class="add-form">
                <div class="form-group">
                    <label for="dateInput">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</label>
                    <input type="date" id="dateInput" required>
                </div>
                <div class="form-group">
                    <label for="timeInput">‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</label>
                    <input type="time" id="timeInput" required>
                </div>
                <div class="form-group">
                    <label for="detailInput">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</label>
                    <textarea id="detailInput" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="phoneInput">‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="tel" id="phoneInput" placeholder="08x-xxx-xxxx">
                </div>
                <div class="form-group">
                    <label for="incidentInput">Incident:</label>
                    <input type="text" id="incidentInput" placeholder="‡∏£‡∏´‡∏±‡∏™ Incident">
                </div>
                <div class="form-group">
                    <label for="onsiteInput">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Onsite:</label>
                    <input type="text" id="onsiteInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Onsite">
                </div>
                <div class="form-group">
                    <label for="receiverInput">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:</label>
                    <input type="text" id="receiverInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á">
                </div>
                <div class="form-group">
                    <button class="btn" onclick="addEntry()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <table id="workTable">
                <thead>
                    <tr>
                        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                        <th>Incident</th>
                        <th>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Onsite</th>
                        <th>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="9" class="no-data">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="summary">
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="number" id="totalCount">0</div>
                </div>
                <div class="summary-card">
                    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="number" id="monthCount">0</div>
                </div>
                <div class="summary-card">
                    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div class="number" id="todayCount">0</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let workEntries = [];
        let currentId = 1;
        let editingId = null;

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        document.getElementById('dateInput').valueAsDate = new Date();

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
        function addEntry() {
            const date = document.getElementById('dateInput').value;
            const time = document.getElementById('timeInput').value;
            const detail = document.getElementById('detailInput').value;
            const phone = document.getElementById('phoneInput').value;
            const incident = document.getElementById('incidentInput').value;
            const onsite = document.getElementById('onsiteInput').value;
            const receiver = document.getElementById('receiverInput').value;

            if (!date || !time || !detail) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
                return;
            }

            const entry = {
                id: currentId++,
                date: date,
                time: time,
                detail: detail,
                phone: phone,
                incident: incident,
                onsite: onsite,
                receiver: receiver
            };

            workEntries.push(entry);
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('timeInput').value = '';
            document.getElementById('detailInput').value = '';
            document.getElementById('phoneInput').value = '';
            document.getElementById('incidentInput').value = '';
            document.getElementById('onsiteInput').value = '';
            document.getElementById('receiverInput').value = '';
            
            updateDisplay();
            updateYearFilter();
            updateSummary();
        }

        // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        function deleteEntry(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                workEntries = workEntries.filter(entry => entry.id !== id);
                editingId = null;
                updateDisplay();
                updateSummary();
            }
        }

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        function editEntry(id) {
            if (editingId !== null && editingId !== id) {
                cancelEdit();
            }
            editingId = id;
            updateDisplay();
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function saveEdit(id) {
            const entry = workEntries.find(entry => entry.id === id);
            if (!entry) return;

            entry.date = document.getElementById(`edit-date-${id}`).value;
            entry.time = document.getElementById(`edit-time-${id}`).value;
            entry.detail = document.getElementById(`edit-detail-${id}`).value;
            entry.phone = document.getElementById(`edit-phone-${id}`).value;
            entry.incident = document.getElementById(`edit-incident-${id}`).value;
            entry.onsite = document.getElementById(`edit-onsite-${id}`).value;
            entry.receiver = document.getElementById(`edit-receiver-${id}`).value;

            editingId = null;
            updateDisplay();
            updateSummary();
        }

        // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function cancelEdit() {
            editingId = null;
            updateDisplay();
        }

        // Export ‡πÄ‡∏õ‡πá‡∏ô Excel
        function exportToExcel() {
            if (workEntries.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export');
                return;
            }

            const exportData = workEntries.map((entry, index) => ({
                '‡∏•‡∏≥‡∏î‡∏±‡∏ö': index + 1,
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': formatThaiDate(entry.date),
                '‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': formatThaiTime(entry.time),
                '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': entry.detail,
                '‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤': entry.phone,
                'Incident': entry.incident,
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Onsite': entry.onsite,
                '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á': entry.receiver
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏á‡∏á‡∏≤‡∏ô');

            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
            const colWidths = [
                { wch: 8 },   // ‡∏•‡∏≥‡∏î‡∏±‡∏ö
                { wch: 20 },  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                { wch: 15 },  // ‡πÄ‡∏ß‡∏•‡∏≤
                { wch: 40 },  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                { wch: 15 },  // ‡πÄ‡∏ö‡∏≠‡∏£‡πå
                { wch: 15 },  // Incident
                { wch: 20 },  // ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà Onsite
                { wch: 20 }   // ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
            ];
            ws['!cols'] = colWidths;

            const today = new Date();
            const fileName = `‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏á‡∏á‡∏≤‡∏ô_${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}.xlsx`;
            
            XLSX.writeFile(wb, fileName);
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        function updateDisplay() {
            const tableBody = document.getElementById('tableBody');
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            let filteredEntries = workEntries.filter(entry => {
                const entryDate = new Date(entry.date);
                const entryYear = entryDate.getFullYear().toString();
                const entryMonth = String(entryDate.getMonth() + 1).padStart(2, '0');
                
                const matchesYear = !yearFilter || entryYear === yearFilter;
                const matchesMonth = !monthFilter || entryMonth === monthFilter;
                const matchesSearch = !searchQuery || 
                    entry.detail.toLowerCase().includes(searchQuery) ||
                    entry.phone.includes(searchQuery) ||
                    entry.incident.toLowerCase().includes(searchQuery) ||
                    entry.onsite.toLowerCase().includes(searchQuery) ||
                    entry.receiver.toLowerCase().includes(searchQuery);

                return matchesYear && matchesMonth && matchesSearch;
            });

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤)
            filteredEntries.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredEntries.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" class="no-data">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</td></tr>';
                return;
            }

            tableBody.innerHTML = filteredEntries.map((entry, index) => {
                const formattedDate = formatThaiDate(entry.date);
                const formattedTime = formatThaiTime(entry.time);
                
                if (editingId === entry.id) {
                    return `
                        <tr>
                            <td>${index + 1}</td>
                            <td><input type="date" id="edit-date-${entry.id}" value="${entry.date}" class="edit-input"></td>
                            <td><input type="time" id="edit-time-${entry.id}" value="${entry.time}" class="edit-input"></td>
                            <td><textarea id="edit-detail-${entry.id}" class="edit-textarea">${entry.detail}</textarea></td>
                            <td><input type="tel" id="edit-phone-${entry.id}" value="${entry.phone}" class="edit-input"></td>
                            <td><input type="text" id="edit-incident-${entry.id}" value="${entry.incident}" class="edit-input"></td>
                            <td><input type="text" id="edit-onsite-${entry.id}" value="${entry.onsite}" class="edit-input"></td>
                            <td><input type="text" id="edit-receiver-${entry.id}" value="${entry.receiver}" class="edit-input"></td>
                            <td>
                                <button class="btn btn-save" onclick="saveEdit(${entry.id})">
                                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                                </button>
                                <button class="btn btn-cancel" onclick="cancelEdit()">
                                    ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                </button>
                            </td>
                        </tr>
                    `;
                } else {
                    return `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${formattedDate}</td>
                            <td>${formattedTime}</td>
                            <td>${entry.detail}</td>
                            <td>${entry.phone}</td>
                            <td>${entry.incident}</td>
                            <td>${entry.onsite}</td>
                            <td>${entry.receiver}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editEntry(${entry.id})">
                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                                <button class="btn btn-delete" onclick="deleteEntry(${entry.id})">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            </td>
                        </tr>
                    `;
                }
            }).join('');
        }

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        function formatThaiDate(dateString) {
            const date = new Date(dateString);
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            const day = date.getDate();
            const month = thaiMonths[date.getMonth()];
            const year = date.getFullYear() + 543;
            
            return `${day} ${month} ${year}`;
        }

        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        function formatThaiTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            return `${hours}:${minutes} ‡∏ô.`;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏õ‡∏µ
        function updateYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            const years = [...new Set(workEntries.map(entry => new Date(entry.date).getFullYear()))];
            years.sort((a, b) => b - a);

            const currentValue = yearFilter.value;
            yearFilter.innerHTML = '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 543;
                yearFilter.appendChild(option);
            });

            yearFilter.value = currentValue;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function updateSummary() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            const thisMonth = today.getMonth();
            const thisYear = today.getFullYear();

            const totalCount = workEntries.length;
            const monthCount = workEntries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getMonth() === thisMonth && entryDate.getFullYear() === thisYear;
            }).length;
            const todayCount = workEntries.filter(entry => entry.date === todayString).length;

            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('monthCount').textContent = monthCount;
            document.getElementById('todayCount').textContent = todayCount;
        }

        // Event Listeners
        document.getElementById('yearFilter').addEventListener('change', updateDisplay);
        document.getElementById('monthFilter').addEventListener('change', updateDisplay);
        document.getElementById('searchInput').addEventListener('input', updateDisplay);

        // ‡∏Å‡∏î Enter ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.getElementById('detailInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                addEntry();
            }
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        updateSummary();
    </script>
</body>
</html>